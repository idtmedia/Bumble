var gdrts_rating_core,gdrts_rating_help,gdrts_rating_dynamic;(function($,f,g,h){gdrts_rating_help={remote:{url:function(){return gdrts_rating_data.url+"?action="+gdrts_rating_data.handler},call:function(a,b,c){$.ajax({url:this.url(),type:"post",dataType:"json",data:{req:JSON.stringify(a)},success:b,error:c})},error:function(a,b,c){var d="Uncaught Error: "+c;if(a.status===0){d="No internet connection, please verify network settings."}else if(a.status===404){d="Error 404: Requested page not found."}else if(a.status===500){d="Error 500: Internal Server Error."}else if(b==="timeout"){d="Request timed out."}else if(b==="abort"){d="Request aborted."}d='GD Rating System - AJAX Error: '+d;if(gdrts_rating_data.ajax_error==="alert"){alert(d)}else if(gdrts_rating_data.ajax_error==="console"){if(f.console){console.log(d)}}}},char:function(a){if(a.substring(0,3)==="&#x"){a=a.replace(";","");a=parseInt(a.substring(3),16);a=String.fromCharCode(a)}else if(a.substring(0,2)==="&#"){a=a.replace(";","");a=parseInt(a.substring(2),10);a=String.fromCharCode(a)}return a}};gdrts_rating_dynamic={init:function(){var a={todo:"dynamic",items:[]};$(".gdrts-dynamic-block").each(function(){a.items.push(gdrts_rating_dynamic.process(this))});gdrts_rating_help.remote.call(a,gdrts_rating_dynamic.load,gdrts_rating_help.remote.error)},process:function(a){var b=JSON.parse($(".gdrts-rating-data",$(a)).html());b.did=gdrts_rating_core.storage.did;$(a).attr("id","gdrts-dynamic-id-"+gdrts_rating_core.storage.did).addClass("gdrts-dynamic-loading");gdrts_rating_core.storage.did++;return b},load:function(c){if(c.status&&c.items&&c.status==="ok"){$.each(c.items,function(a,b){gdrts_rating_dynamic.item(b)})}},item:function(a){var b=$(a.render).hide();$("#gdrts-dynamic-id-"+a.did).fadeOut(150,function(){$(this).replaceWith(b);b.fadeIn(300,function(){gdrts_rating_core.common.process(this);if($(this).hasClass("gdrts-method-stars-rating")){gdrts_rating_core.stars_rating.single.process($(".gdrts-stars-rating",this))}})})}};gdrts_rating_core={storage:{uid:1,did:1,stars:[]},_b:function(a){var b=$(a).data("uid");return $("#gdrts-unique-id-"+b)},_d:function(a){return this._b(a).data("rating")},init:function(){if($(".gdrts-dynamic-block").length>0){gdrts_rating_dynamic.init()}$(".gdrts-rating-block, .gdrts-rating-list").each(function(){gdrts_rating_core.common.process(this)});gdrts_rating_core.common.methods()},live:function(){$(g).on("click",".gdrts-toggle-distribution",function(e){e.preventDefault();var a=$(this).hasClass("gdrts-toggle-open");if(a){$(this).removeClass("gdrts-toggle-open");$(this).html($(this).data("show"));$(".gdrts-rating-distribution",$(this).closest(".gdrts-rating-block")).slideUp()}else{$(this).addClass("gdrts-toggle-open");$(this).html($(this).data("hide"));$(".gdrts-rating-distribution",$(this).closest(".gdrts-rating-block")).slideDown()}})},style:{star:function(a,b){if($.inArray(a,gdrts_rating_core.storage.stars)===-1){var c=".gdrts-with-fonticon.gdrts-fonticon-"+b.name+".gdrts-"+b.name+"-"+b.font+".gdrts-stars-length-"+b.length,rule=c+" .gdrts-stars-empty::before, "+c+" .gdrts-stars-active::before, "+c+" .gdrts-stars-current::before { "+"content: \""+b.content+"\"; }",desc="/* stars: "+b.name+" - "+b.font+" - "+b.length+" */",id="gdrts-style-stars-"+b.name+"-"+b.font+"-"+b.length;$("<style type=\"text/css\" id=\""+id+"\">\r\n"+desc+"\r\n"+rule+"\r\n\r\n</style>").appendTo("head");gdrts_rating_core.storage.stars.push(a)}}},common:{process:function(a){var b=JSON.parse($(".gdrts-rating-data",$(a)).html());b.uid=gdrts_rating_core.storage.uid;$(a).attr("id","gdrts-unique-id-"+gdrts_rating_core.storage.uid).data("uid",gdrts_rating_core.storage.uid).data("rating",b);$(".gdrts-rating-element",a).data("uid",gdrts_rating_core.storage.uid);gdrts_rating_core.storage.uid++},methods:function(){gdrts_rating_core.stars_rating.single.init();gdrts_rating_core.stars_rating.list.init()},error:function(a){$("#gdrts-unique-id-"+a.uid).removeClass("gdrts-vote-saving").append('<div class="gdrts-error-message">'+a.message+'</div>')}},stars_rating:{single:{init:function(){$(".gdrts-rating-block .gdrts-stars-rating").each(function(){gdrts_rating_core.stars_rating.single.process(this)})},call:function(a,b){var c=gdrts_rating_core._d(a),args={todo:"vote",method:"stars-rating",item:c.item.item_id,nonce:c.item.nonce,render:c.render,uid:c.uid,meta:{value:b,max:c.stars.max}};gdrts_rating_help.remote.call(args,gdrts_rating_core.stars_rating.single.voted,gdrts_rating_help.remote.error)},voted:function(a){if(a.status==="error"){gdrts_rating_core.common.error(a)}else{var b=$(a.render).hide();$("#gdrts-unique-id-"+a.uid).fadeOut(150,function(){$(this).replaceWith(b);b.fadeIn(300,function(){gdrts_rating_core.common.process(this);gdrts_rating_core.stars_rating.single.process($(".gdrts-stars-rating",this));$(this).attr("role","alert")})})}},process:function(a){var b=gdrts_rating_core._d(a).stars,labels=gdrts_rating_core._d(a).labels;if($(a).hasClass("gdrts-with-fonticon")){var c=b.type+"-"+b.name+"-"+b.max,obj={font:b.name,name:b.type,length:b.max,content:Array(b.max+1).join(gdrts_rating_help.char(b.char))};gdrts_rating_core.style.star(c,obj)}if($(a).hasClass("gdrts-state-active")){gdrts_rating_core.stars_rating.single.activity(a,b,labels)}if(b.responsive){$(f).bind("load resize orientationchange",{el:a,data:b},gdrts_rating_core.responsive.stars);gdrts_rating_core.responsive._s({el:a,data:b})}},activity:function(b,c,d){$(".gdrts-stars-empty",b).mouseleave(function(e){if($(this).hasClass("gdrts-vote-saving"))return;var a=$(this).parent().find("input").val(),width=$(this).width(),star=width/c.max,current=star*a;$(b).data("selected",a).attr("title","");$(".gdrts-stars-active",this).width(current)});$(".gdrts-stars-empty",b).mousemove(function(e){if($(this).hasClass("gdrts-vote-saving"))return;var a=$(this).offset(),width=$(this).width(),star=width/c.max,res=c.resolution,step=res*(star/100),x=e.pageX-a.left,parts=Math.ceil(x/step),current=parseFloat((parts*(res/100)).toFixed(2)),lid=Math.ceil(current*1),label=d[lid-1],active=parts*step;$(b).data("selected",current).attr("title",current+": "+label);$(".gdrts-stars-active",this).width(active)});$(".gdrts-sr-button",b).click(function(e){e.preventDefault();var a=$(this).parent().find(".gdrts-sr-rating");gdrts_rating_core.stars_rating.single.do_rating($(a).val(),a.parent(),b)});$(".gdrts-stars-empty",b).click(function(e){e.preventDefault();gdrts_rating_core.stars_rating.single.do_rating($(b).data("selected"),this,b)})},do_rating:function(a,t,b){if($(t).hasClass("gdrts-vote-saving"))return;$(t).parent().find("input").val(a);if($(t).parent().hasClass("gdrts-passive-rating"))return;$(t).addClass("gdrts-vote-saving");gdrts_rating_core._b($(t).parent()).addClass("gdrts-vote-saving");gdrts_rating_core.stars_rating.single.call(b,a)}},list:{init:function(){$(".gdrts-rating-list .gdrts-stars-rating").each(function(){gdrts_rating_core.stars_rating.list.process(this)})},process:function(a){var b=gdrts_rating_core._d(a).stars;if($(a).hasClass("gdrts-with-fonticon")){var c=b.type+"-"+b.name+"-"+b.max,obj={font:b.name,name:b.type,length:b.max,content:Array(b.max+1).join(gdrts_rating_help.char(b.char))};gdrts_rating_core.style.star(c,obj)}if(b.responsive){$(f).bind("load resize orientationchange",{el:a,data:b},gdrts_rating_core.responsive.stars);gdrts_rating_core.responsive._s({el:a,data:b})}}}},responsive:{_s:function(a){var b=a.el,data=a.data,available=$(b).parent().width(),new_size=Math.floor(available/data.max);new_size=new_size>data.size?data.size:new_size;if(data.type==="image"){$(".gdrts-stars-empty, .gdrts-stars-active, .gdrts-stars-current",b).css("background-size",new_size+"px");$(b).css("height",new_size+"px").css("width",data.max*new_size+"px")}else{$(".gdrts-stars-empty",b).css("font-size",new_size+"px").css("line-height",new_size+"px");$(b).css("line-height",new_size+"px").css("height",new_size+"px")}},stars:function(e){gdrts_rating_core.responsive._s(e.data)}}};f.wp=f.wp||{};f.wp.gdrts=f.wp.gdrts||{};f.wp.gdrts.help=gdrts_rating_help;f.wp.gdrts.dynamic=gdrts_rating_dynamic;f.wp.gdrts.core=gdrts_rating_core;f.wp.gdrts.core.init();f.wp.gdrts.core.live()})(jQuery,window,document);
