var alsp_map=null,alsp_allow_map_zoom=!0,alsp_geocoder=null,alsp_infoWindow=null,alsp_markersArray=[],alsp_glocation_backend=function(a,e,s,o,l,p,n){this.index=a,this.point=e,this.location=s,this.address_line_1=o,this.address_line_2=l,this.zip_or_postal_index=p,this.map_icon_file=n,this.alsp_placeMarker=function(){return alsp_placeMarker_backend(this)},this.compileAddress=function(){var a=this.address_line_1;return this.address_line_2&&(a+=", "+this.address_line_2),this.location&&(a&&(a+=" "),a+=this.location),alsp_google_maps_objects.default_geocoding_location&&(a&&(a+=" "),a+=alsp_google_maps_objects.default_geocoding_location),this.zip_or_postal_index&&(a&&(a+=" "),a+=this.zip_or_postal_index),a},this.compileHtmlAddress=function(){var a=this.address_line_1;return this.address_line_2&&(a+=", "+this.address_line_2),this.location&&((this.address_line_1||this.address_line_2)&&(a+="<br />"),a+=this.location),this.zip_or_postal_index&&(a+=" "+this.zip_or_postal_index),a},this.setPoint=function(a){this.point=a}};!function($){"use strict";var alsp_load_maps_backend=function(){if(document.getElementById("alsp-maps-canvas")){var mapOptions={zoom:1,scrollwheel:!0,gestureHandling:"greedy",disableDoubleClickZoom:!0,mapTypeId:google.maps.MapTypeId.ROADMAP,fullscreenControl:!1};"default"!=alsp_google_maps_objects.map_style_name&&alsp_google_maps_objects.map_styles&&(mapOptions.styles=eval(alsp_google_maps_objects.map_styles[alsp_google_maps_objects.map_style_name])),alsp_map=new google.maps.Map(document.getElementById("alsp-maps-canvas"),mapOptions),alsp_geocoder=new google.maps.Geocoder;var alsp_coords_array_1=new Array,alsp_coords_array_2=new Array;alsp_isAnyLocation_backend()?alsp_generateMap_backend():alsp_map.setCenter(new google.maps.LatLng(34,0)),google.maps.event.addListener(alsp_map,"zoom_changed",function(){alsp_allow_map_zoom&&jQuery(".alsp-map-zoom").val(alsp_map.getZoom())})}};function alsp_setMapCenter_backend(a,e){for(var s=0,o=new google.maps.LatLngBounds;s<a.length;s++)o.extend(new google.maps.LatLng(a[s],e[s]));if(1==s)if(""==jQuery(".alsp-map-zoom").val()||0==jQuery(".alsp-map-zoom").val())var l=1;else l=parseInt(jQuery(".alsp-map-zoom").val());else{alsp_map.fitBounds(o);l=alsp_map.getZoom()}alsp_map.setCenter(o.getCenter()),alsp_allow_map_zoom=!1,alsp_map.setZoom(l),alsp_allow_map_zoom=!0}window.alsp_load_maps_api_backend=function(){$(document).trigger("alsp_google_maps_api_loaded"),google.maps.event.addDomListener(window,"load",alsp_load_maps_backend()),alsp_load_maps_api(),alsp_setupAutocomplete()},window.alsp_setupAutocomplete=function(){$(".alsp-field-autocomplete").each(function(){if(google.maps&&google.maps.places){if("0"!=alsp_google_maps_objects.address_autocomplete_code)var a={componentRestrictions:{country:alsp_google_maps_objects.address_autocomplete_code}};else a={};var e=new google.maps.places.Autocomplete(this,a);google.maps.event.addListener(e,"place_changed",function(){alsp_generateMap_backend()})}})};var alsp_coords_array_1=new Array,alsp_coords_array_2=new Array,alsp_attempts=0;function alsp_geocodeAddress_backend(p){if($(".alsp-location-in-metabox:eq("+p+")").length){var s=[];$(".alsp-location-in-metabox:eq("+p+")").find("select").each(function(a,e){$(this).val()&&s.push($(this).children(":selected").text())});var a=s.reverse().join(", ");if(!$(".alsp-manual-coords:eq("+p+")").is(":checked")||""==jQuery(".alsp-map-coords-1:eq("+p+")").val()||""==$(".alsp-map-coords-2:eq("+p+")").val()||0==$(".alsp-map-coords-1:eq("+p+")").val()&&0==$(".alsp-map-coords-2:eq("+p+")").val())if(a||$(".alsp-address-line-1:eq("+p+")").val()||$(".alsp-address-line-2:eq("+p+")").val()||$(".alsp-zip-or-postal-index:eq("+p+")").val()){n=new alsp_glocation_backend(p,null,a,$(".alsp-address-line-1:eq("+p+")").val(),$(".alsp-address-line-2:eq("+p+")").val(),$(".alsp-zip-or-postal-index:eq("+p+")").val(),$(".alsp-map-icon-file:eq("+p+")").val());alsp_geocoder.geocode({address:n.compileAddress()},function(a,e){if(e!=google.maps.GeocoderStatus.OK)"OVER_QUERY_LIMIT"==e&&alsp_attempts<5?(alsp_attempts++,setTimeout("alsp_geocodeAddress_backend("+p+")",2e3)):(alert("Sorry, we were unable to geocode that address (address #"+p+") for the following reason: "+e),alsp_ajax_loader_hide());else{var s=a[0].geometry.location;$(".alsp-map-coords-1:eq("+p+")").val(s.lat()),$(".alsp-map-coords-2:eq("+p+")").val(s.lng());var o=s.lat(),l=s.lng();alsp_coords_array_1.push(o),alsp_coords_array_2.push(l),n.setPoint(s),n.alsp_placeMarker(),alsp_geocodeAddress_backend(p+1)}p+1==$(".alsp-location-in-metabox").length&&(alsp_setMapCenter_backend(alsp_coords_array_1,alsp_coords_array_2),alsp_ajax_loader_hide())})}else alsp_ajax_loader_hide();else{var e=$(".alsp-map-coords-1:eq("+p+")").val(),o=$(".alsp-map-coords-2:eq("+p+")").val();if($.isNumeric(e)&&$.isNumeric(o)){var n,l=new google.maps.LatLng(e,o);alsp_coords_array_1.push(e),alsp_coords_array_2.push(o),(n=new alsp_glocation_backend(p,l,a,$(".alsp-address-line-1:eq("+p+")").val(),$(".alsp-address-line-2:eq("+p+")").val(),$(".alsp-zip-or-postal-index:eq("+p+")").val(),$(".alsp-map-icon-file:eq("+p+")").val())).alsp_placeMarker()}alsp_geocodeAddress_backend(p+1),p+1==jQuery(".alsp-location-in-metabox").length&&(alsp_setMapCenter_backend(alsp_coords_array_1,alsp_coords_array_2),alsp_ajax_loader_hide())}}else alsp_attempts=0}function alsp_show_infoWindow_backend(a,e){address=a.compileHtmlAddress();a.index;alsp_infoWindow||(alsp_infoWindow=new google.maps.InfoWindow),alsp_infoWindow.setContent(address),alsp_infoWindow.open(alsp_map,e)}function alsp_clearOverlays_backend(){if(alsp_markersArray)for(var a=0;a<alsp_markersArray.length;a++)alsp_markersArray[a].setMap(null)}function alsp_isAnyLocation_backend(){var s=!1;return $(".alsp-location-in-metabox").each(function(a,e){if($(this).find("select").each(function(a,e){if($(this).val())return!(s=!0)}),$(".alsp-manual-coords:eq("+a+")").is(":checked")&&""!=$(".alsp-map-coords-1:eq("+a+")").val()&&""!=$(".alsp-map-coords-2:eq("+a+")").val()&&(0!=$(".alsp-map-coords-1:eq("+a+")").val()||0!=$(".alsp-map-coords-2:eq("+a+")").val()))return!(s=!0)}),!!s||(0!=$(".alsp-address-line-1[value!='']").length||(0!=$(".alsp-address-line-2[value!='']").length||(0!=$(".alsp-zip-or-postal-index[value!='']").length||void 0)))}window.alsp_generateMap_backend=function(){alsp_coords_array_1=new Array,alsp_coords_array_2=new Array,alsp_attempts=0,alsp_clearOverlays_backend(),alsp_geocodeAddress_backend(0),alsp_setupAutocomplete()},window.alsp_placeMarker_backend=function(s){if("icons"!=alsp_google_maps_objects.map_markers_type){if(""!=alsp_google_maps_objects.global_map_icons_path){if(s.map_icon_file)var a=alsp_google_maps_objects.global_map_icons_path+"icons/"+s.map_icon_file;else a=alsp_google_maps_objects.global_map_icons_path+"blank.png";var e={url:a,size:new google.maps.Size(parseInt(alsp_google_maps_objects.marker_image_width),parseInt(alsp_google_maps_objects.marker_image_height)),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(parseInt(alsp_google_maps_objects.marker_image_anchor_x),parseInt(alsp_google_maps_objects.marker_image_anchor_y))};if(1==alsp_js_objects.manual_coods)var o=!0;else o=!1;var l=new google.maps.Marker({position:s.point,map:alsp_map,icon:e,draggable:o})}else l=new google.maps.Marker({position:s.point,map:alsp_map,draggable:o});alsp_markersArray.push(l),google.maps.event.addListener(l,"click",function(){alsp_show_infoWindow_backend(s,l)}),google.maps.event.addListener(l,"dragend",function(a){var e=l.getPosition();if(void 0!==e){s.index;$(".alsp-manual-coords:eq("+s.index+")").attr("checked",!0),$(".alsp-manual-coords:eq("+s.index+")").parents(".alsp-manual-coords-wrapper").find(".alsp-manual-coords-block").show(200),$(".alsp-map-coords-1:eq("+s.index+")").val(e.lat()),$(".alsp-map-coords-2:eq("+s.index+")").val(e.lng())}})}else{alsp_load_richtext();var p=!1,n=!1;if(s.map_icon_file&&alsp_in_array(s.map_icon_file,alsp_google_maps_objects.map_markers_array)?p=s.map_icon_file:!p&&alsp_google_maps_objects.default_marker_icon&&(p=alsp_google_maps_objects.default_marker_icon),n||(n=alsp_google_maps_objects.default_marker_color?alsp_google_maps_objects.default_marker_color:"#2393ba"),p)var _='<span class="alsp-map-marker-icon fa '+p+'" style="color: '+n+';"></span>',r="alsp-map-marker";else _="",r="alsp-map-marker-empty";l=new RichMarker({position:s.point,map:alsp_map,flat:!0,draggable:!0,height:40,content:'<div class="'+r+'" style="background: '+n+' none repeat scroll 0 0;">'+_+"</div>"});alsp_markersArray.push(l),google.maps.event.addListener(l,"position_changed",function(a){var e=l.getPosition();if(void 0!==e){s.index;$(".alsp-manual-coords:eq("+s.index+")").attr("checked",!0),$(".alsp-manual-coords:eq("+s.index+")").parents(".alsp-manual-coords-wrapper").find(".alsp-manual-coords-block").show(200),$(".alsp-map-coords-1:eq("+s.index+")").val(e.lat()),$(".alsp-map-coords-2:eq("+s.index+")").val(e.lng())}})}}}(jQuery);